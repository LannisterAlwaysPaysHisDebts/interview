# 常见开发场景QA
## 理论
### 小程序开发与普通后台开发最大的区别是什么?
### 你怎么评估重构业务。重构的标准是什么？怎么灰度切换？

### hash表设计要注意什么问题

### 写金融类的系统有什么需要关注的地方
金额的精确位数，金额的加减操作，谨防溢出

## 实现
### 手写一个洗牌算法

### 设计一个发号器，考虑集群和高并发的情况，要求发号器生成的id是递增趋势，通过id可以区分出来是今天生成的id还是昨天生成的id，但是生成的id中不能直接带有日期，要具有一定的混淆功能

### 手写循环队列,保证线程安全;

### 生产者消费者模式，手写代码; channel缓冲长度怎么决定，怎么控制上游生产速度过快;多生产者多消费者;

### 实现set,保证线程安全;
使用sync.Map实现

### 大文件排序

### go语言实现RSA与AES加密

### 如何使用go来实现一个连接池?
sync.Pool?

### 大致实现一个LRU、LFU算法

### go-micro怎么实现水平部署的，代码怎么实现

### 使用go实现tps统计

### 守护进程是什么，怎么实现?

### 架构设计-微信朋友圈

### 描述APP push推送架构设计

### 给你1亿个URL。爬取信息。会遇到什么问题？从 CPU 磁盘 网络 等方面。

### 假设我们现在要做一对一视频聊天，每日 DAU 可能达到几十万以上，后端怎么实现一对一匹配的算法？还有，怎么实现快速的匹配服务器不会有压力问题？

### 微信支付这块，在支付完微信通知这里，收到两次微信相同的支付通知，怎么防止重复消费（类似接口的幂等性）
- 前端不能允许用户连续按两次支付按钮,或者说不能连续发两次支付请求;
- 每次支付生成唯一流水号, 不允许同一个流水号重复扣款;
- 高并发情况下: 悲观锁, 如zk/redis的分布式锁;缺点是需要引入额外的组件,并且降低吞吐量;(CAP放弃了A)
- 使用mq将操作拉成线性;

解决办法:
- 业务层面CAS(Compare and set)的方法, `update t set money=28 where uid=xx and money=100`; sql增加`and money=100`部分;这样操作同时进行,只有一个会成功;
- DB层面开启事务,读的时候加上`for update`排他锁;

ABA问题: 事务A取出money=100, 事务B扣款成80, 事务C加钱成100, 此时仍然满足`and money=100`条件; 解决办法:增加版本号字段, 每次修改都需要更新版本号, update从money的比对优化为版本号的比对;
> 大多数情况下的ABA问题,并不影响数据的准确性;

### 单点登录如何实现?，tcp粘包问题?

### 怎么做数据同步?

### 考虑一个业务场景: 头条的文章的评论量非常大, 比如说一篇热门文章就有几百万的评论, 设计一个后端服务, 实现评论的时序展示与分页
我: 需不需要支持页码直接跳转?面试官: 支持和不支持两种场景都考虑一下我: 不需要支持页码翻页就传评论 id 用 offset 翻页

假如用 id 翻页的方式, 数据库表如何设计? 索引如何设计?(文章id, 评论id) 建联合索引，评论 id 需递增,

假如量很大, 你觉得需要分库分表吗? 怎么分?需要分，分表有个权衡，按文章 id 分表，读逻辑简单，但写有热点问题；按评论 id 分表，读逻辑复杂，但写压力就平均了。写是要首先保证的，而读总是有缓存等方案来折中，因此按评论 id 分表好。

分库分表后怎么查询分页?每张表查 N 条数据由 client 或 proxy merge
分库分表后怎么保证主键仍然是递增的?讲了 TDDL 的办法：有一张专门用于分配主键的表，每次用乐观锁的方式尝试去取一批主键过来分配，假如乐观锁失败就重试

现在需要支持深分页, 页码直接跳转, 怎么实现?不能做精准深分页，否则压力太大，找产品进行妥协，在50或100页后数据分页是否可以不完全精确，假如可以，那么缓存深页码的起始评论 id

### 设计一个分布式服务的容错机制。

### A,B 系统转账如何保证分布式数据一致性?A 往 B 转钱,B 往 A 转钱,同时的会死锁吗?如何解决死锁?
使用分布式锁. 

死锁产生的四个条件：
1. 资源一次只能被一个线程占有
2. 线程请求其他资源时，不释放当前占有的资源
3. 线程占有的资源不会被系统剥夺
4. 不同线程对资源的占有形成了环状关系;

那么解决死锁，只需要破坏上述四个条件中的一个就可以了。

### 如何防止超卖?
1. mysql: 
    - 加版本号,select获取商品数量与版本号,在update时增加版本号的where条件; 
    - 如果有限制一人抢一份,可以建立userId与商品id的唯一键;
2. 分布式锁: redis,zk; 
3. go微服务,启动一个协程,将商品数量记在变量里面,每次请求都加锁对变量做`--`操作

### 如何做租户的隔离?
三种方案:
- 独立数据库: 
    优点: 可以简化设计,满足不同用户不同需求;隔离性最强,故障恢复简单;
    缺点: 贵;
- 隔离数据架构(对mysql来说就是分表/分库)
- 通过字段隔离:
    优点: 便宜;
    缺点: 隔离性最低、安全性最低,数据恢复困难;

根据实际业务选择不同的隔离方式,我们对外服务以字段隔离;

## 问题排查

### 怎么查看Linux服务器的负载，及判断哪些操作引起的负载过高

### 线上突然大量502.怎么排查?

### 接口如何进行QPS、TPS测试? 一般会有什么问题?二八定律

### 智力题：1000瓶酒中有1瓶毒酒，10只老鼠，7天后毒性才发作，第8天要卖了，怎么求那瓶毒酒？
知识点：二进制。
解题思路：把10只老鼠当成10位编码,喂酒代表1不喂酒代表0;将1000瓶酒从1到1000进行2进制编码,按照编码给老鼠喂酒.等毒性发作就可以根据老鼠死亡的编号来知道是第几瓶酒有毒.

### 服务器CPU 100%怎么定位
先用top定位出问题的进程，再用top定位到出问题的线程，再打印线程堆栈查看运行情况/看日志;

### 内存溢出的排查过程

### 如何提前发现你的数据有问题,而不是等到用户反馈才知道?

## 安全
### 日常开发需要注意的安全问题?
### 简述你对md5加密的理解
### 简述你对jwt的理解,对oauth2的理解
### 如何防止sql注入攻击?
### 如何防止前端xss? 
HTML内容和属性转义,JS转义,富文本 ,CSP,PHP-XSS

### 前端CSRF:
CSRF防御:samesite,验证码,token,referer,PHP-CSRF

### 前端Cookies:Cookies和XSS CSRF的关系与案例
### 前端点击劫持
### 传输安全:HTTP窃听,HTTPS部署
### 密码安全
### 接入层上传:上传漏洞防御
### 社会工程学和信息泄露:利用OAuth思想保护用户资料
### 重放攻击
### DOS攻击

